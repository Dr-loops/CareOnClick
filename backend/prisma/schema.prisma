generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
  id                 String   @id @default(cuid())
  email              String   @unique
  password           String // Hashed
  name               String
  role               String // patient, doctor, admin, nurse, etc.
  pathNumber         String?  @unique // For patients
  verificationStatus String   @default("Pending") // Verified, Pending, Rejected
  createdAt          DateTime @default(now())
  updatedAt          DateTime @updatedAt

  // Professional Details (Optional for non-professionals)
  licenseNumber     String?
  yearsOfExperience Int?
  currentFacility   String?
  facilityType      String? // Private, Government
  country           String? // Added for new requirements
  region            String?
  address           String? // Added for Professional Address
  phoneNumber       String? // Global contact number
  whatsappNumber    String?
  avatarUrl         String? // Base64 or URL
  bio               String? // Professional Biography
  specialization    String? // e.g. Cardiologist, Pediatrician

  // Relations
  profile                    PatientProfile?
  appointmentsAsPatient      Appointment[]   @relation("PatientAppointments")
  appointmentsAsProfessional Appointment[]   @relation("ProfessionalAppointments")
  sentMessages               Message[]       @relation("SentMessages")
  notifications              Notification[]
  VitalSign                  VitalSign[]
  Task                       Task[]
}

model PatientProfile {
  id                 String    @id @default(cuid())
  userId             String    @unique
  user               User      @relation(fields: [userId], references: [id], onDelete: Cascade)
  dateOfBirth        DateTime?
  gender             String?
  address            String?
  phoneNumber        String?
  region             String?
  allergies          String? // JSON string or text
  medicalHistory     String? // JSON string or text
  currentMedications String?

  // Hospital Stay Details
  currentRoom     String? // e.g. "302-A"
  admissionStatus String? // "Admitted", "Discharged", "Observation"
  conditionStatus String? // "Stable", "Critical", "Fair"
}

model Appointment {
  id                   String   @id @default(cuid())
  patientId            String
  patientName          String
  professionalId       String
  professionalName     String
  professionalCategory String // Doctor, Dietician, etc.
  date                 DateTime
  time                 String // Could be part of date, but keeping separate for now as per legacy
  type                 String // Video, In-person
  reason               String?
  status               String   @default("Upcoming") // Upcoming, Completed, Cancelled
  paymentStatus        String   @default("Pending") // Paid, Pending
  amountPaid           Float    @default(0)
  balanceDue           Float    @default(0)
  paymentMethod        String?  // e.g. "MOMO", "VISA"

  // Telemedicine Fields
  channelName String? // Unique room ID for Agora
  videoToken  String? // Security token for Agora

  createdAt DateTime @default(now())

  patient      User @relation("PatientAppointments", fields: [patientId], references: [id])
  professional User @relation("ProfessionalAppointments", fields: [professionalId], references: [id])
}

model Message {
  id            String   @id @default(cuid())
  senderId      String
  senderName    String
  role          String
  recipientId   String? // Added for Direct Messaging
  recipientName String? // Added for UI display
  type          String   @default("CHAT") // CHAT, SMS, EMAIL
  content       String
  attachment    String? // JSON { type, url, name }
  timestamp     DateTime @default(now())

  sender User @relation("SentMessages", fields: [senderId], references: [id])
}

model Notification {
  id        String   @id @default(cuid())
  userId    String // Recipient
  title     String
  message   String
  type      String // APPOINTMENT_BOOKED, etc.
  status    String   @default("Unread") // Unread, Read, Dismissed
  metadata  String? // JSON details
  timestamp DateTime @default(now())

  user User @relation(fields: [userId], references: [id], onDelete: Cascade)
}

model AuditLog {
  id        String   @id @default(cuid())
  action    String
  actorId   String
  actorName String
  target    String?
  details   String?
  timestamp DateTime @default(now())
}

model MedicalRecord {
  id               String   @id @default(cuid())
  patientId        String
  patientName      String?
  professionalId   String
  professionalName String
  professionalRole String
  date             String // Storing as string to match legacy YYYY-MM-DD format for now
  time             String
  fileName         String
  fileType         String?
  fileUrl          String?
  unit             String? // e.g. "Haematology" or "Clinical"
  structuredData   String? // JSON string for test results
  createdAt        DateTime @default(now())

  // Relations could be added but simpler to keep loose for this rapid dev phase
  // patient User @relation(...) 
}

model Ad {
  id        String    @id @default(cuid())
  title     String
  type      String // "IMAGE" or "VIDEO"
  url       String // URL to media file
  link      String? // Click-through URL
  active    Boolean   @default(true)
  startDate DateTime  @default(now())
  endDate   DateTime?
  priority  Int       @default(0) // Higher shows first
  createdAt DateTime  @default(now())
}

model NewsItem {
  id          String   @id @default(cuid())
  title       String
  summary     String
  content     String // Full text content
  imageUrl    String? // URL to news image
  category    String? // Health, Update, Education
  published   Boolean  @default(true)
  publishedAt DateTime @default(now())
  createdAt   DateTime @default(now())
}

model VitalSign {
  id              String   @id @default(cuid())
  patientId       String
  temperature     Float // e.g. 36.8
  bloodPressure   String // e.g. "120/80"
  heartRate       Int // e.g. 72
  spo2            Int // e.g. 98
  respiratoryRate Int? // Optional
  recordedAt      DateTime @default(now())
  recordedBy      String? // Name or ID of professional

  patient User @relation(fields: [patientId], references: [id], onDelete: Cascade)
}

model Task {
  id           String    @id @default(cuid())
  patientId    String
  patientName  String? // Cache for easy display
  assignedToId String? // Professional ID
  description  String // e.g. "Check Vitals"
  category     String // e.g. "Medication", "Clinical", "Wound Care"
  status       String    @default("Pending") // Pending, Completed, Cancelled
  priority     String    @default("Normal") // Normal, Urgent, Stat
  dueDate      DateTime?
  completedAt  DateTime?
  completedBy  String?
  createdAt    DateTime  @default(now())
  updatedAt    DateTime  @updatedAt

  patient User @relation(fields: [patientId], references: [id], onDelete: Cascade)
}
